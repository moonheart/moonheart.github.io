<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>esxi 中的 CentOS lvm扩容磁盘 | 月心月士的博客</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="首先在 vCenter 控制面板中增加磁盘容量并重启系统  root@server ~]# fdisk /dev/sda Command (m for help): p  Disk /dev/sda: 171.8 GB, 171798691840 bytes, 335544320 sectors Units = sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disk label type: dos Disk identifier: 0x000dbca9  Device Boot Start End Blocks Id System /dev/sda1 * 2048 2099199 1048576 83 Linux /dev/sda2 2099200 167772159 82836480 83 Linux  Command (m for help): d Partition number (1,2, default 2): 2 Partition 2 is deleted  Command (m for help): n Partition type: p primary (1 primary, 0 extended, 3 free) e extended Select (default p): p Partition number (2-4, default 2): First sector (2099200-335544319, default 2099200): Using default value 2099200 Last sector, +sectors or +size{K,M,G} (2099200-335544319, default 335544319): Using default value 335544319 Partition 2 of type Linux and of size 159 GiB is set  Command (m for help): p  Disk /dev/sda: 171."><meta name=generator content="Hugo 0.97.3"><meta name=robots content="noindex, nofollow"><link rel=stylesheet href=/ananke/css/main.min.css><meta property="og:title" content="esxi 中的 CentOS lvm扩容磁盘"><meta property="og:description" content="首先在 vCenter 控制面板中增加磁盘容量并重启系统  root@server ~]# fdisk /dev/sda Command (m for help): p  Disk /dev/sda: 171.8 GB, 171798691840 bytes, 335544320 sectors Units = sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disk label type: dos Disk identifier: 0x000dbca9  Device Boot Start End Blocks Id System /dev/sda1 * 2048 2099199 1048576 83 Linux /dev/sda2 2099200 167772159 82836480 83 Linux  Command (m for help): d Partition number (1,2, default 2): 2 Partition 2 is deleted  Command (m for help): n Partition type: p primary (1 primary, 0 extended, 3 free) e extended Select (default p): p Partition number (2-4, default 2): First sector (2099200-335544319, default 2099200): Using default value 2099200 Last sector, +sectors or +size{K,M,G} (2099200-335544319, default 335544319): Using default value 335544319 Partition 2 of type Linux and of size 159 GiB is set  Command (m for help): p  Disk /dev/sda: 171."><meta property="og:type" content="article"><meta property="og:url" content="http://example.org/posts/esxi-zhong-de-centos-lvm-kuo-rong-ci-pan/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-01-13T21:21:00+08:00"><meta property="article:modified_time" content="2020-01-13T21:21:00+08:00"><meta itemprop=name content="esxi 中的 CentOS lvm扩容磁盘"><meta itemprop=description content="首先在 vCenter 控制面板中增加磁盘容量并重启系统  root@server ~]# fdisk /dev/sda Command (m for help): p  Disk /dev/sda: 171.8 GB, 171798691840 bytes, 335544320 sectors Units = sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disk label type: dos Disk identifier: 0x000dbca9  Device Boot Start End Blocks Id System /dev/sda1 * 2048 2099199 1048576 83 Linux /dev/sda2 2099200 167772159 82836480 83 Linux  Command (m for help): d Partition number (1,2, default 2): 2 Partition 2 is deleted  Command (m for help): n Partition type: p primary (1 primary, 0 extended, 3 free) e extended Select (default p): p Partition number (2-4, default 2): First sector (2099200-335544319, default 2099200): Using default value 2099200 Last sector, +sectors or +size{K,M,G} (2099200-335544319, default 335544319): Using default value 335544319 Partition 2 of type Linux and of size 159 GiB is set  Command (m for help): p  Disk /dev/sda: 171."><meta itemprop=datePublished content="2020-01-13T21:21:00+08:00"><meta itemprop=dateModified content="2020-01-13T21:21:00+08:00"><meta itemprop=wordCount content="401"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="esxi 中的 CentOS lvm扩容磁盘"><meta name=twitter:description content="首先在 vCenter 控制面板中增加磁盘容量并重启系统  root@server ~]# fdisk /dev/sda Command (m for help): p  Disk /dev/sda: 171.8 GB, 171798691840 bytes, 335544320 sectors Units = sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disk label type: dos Disk identifier: 0x000dbca9  Device Boot Start End Blocks Id System /dev/sda1 * 2048 2099199 1048576 83 Linux /dev/sda2 2099200 167772159 82836480 83 Linux  Command (m for help): d Partition number (1,2, default 2): 2 Partition 2 is deleted  Command (m for help): n Partition type: p primary (1 primary, 0 extended, 3 free) e extended Select (default p): p Partition number (2-4, default 2): First sector (2099200-335544319, default 2099200): Using default value 2099200 Last sector, +sectors or +size{K,M,G} (2099200-335544319, default 335544319): Using default value 335544319 Partition 2 of type Linux and of size 159 GiB is set  Command (m for help): p  Disk /dev/sda: 171."></head><body class="ma0 avenir bg-near-white"><header><div class=bg-black><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">月心月士的博客</a><div class="flex-l items-center"><div class=ananke-socials></div></div></div></nav></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">POSTS</aside><div id=sharing class="mt3 ananke-socials"></div><h1 class="f1 athelas mt3 mb1">esxi 中的 CentOS lvm扩容磁盘</h1><time class="f6 mv4 dib tracked" datetime=2020-01-13T21:21:00+08:00>January 13, 2020</time></header><div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><ol><li>首先在 vCenter 控制面板中增加磁盘容量并重启系统</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>root@server ~<span style=color:#f92672>]</span><span style=color:#75715e># fdisk /dev/sda</span>
</span></span><span style=display:flex><span>Command <span style=color:#f92672>(</span>m <span style=color:#66d9ef>for</span> help<span style=color:#f92672>)</span>: p
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Disk /dev/sda: 171.8 GB, <span style=color:#ae81ff>171798691840</span> bytes, <span style=color:#ae81ff>335544320</span> sectors
</span></span><span style=display:flex><span>Units <span style=color:#f92672>=</span> sectors of <span style=color:#ae81ff>1</span> * 512 <span style=color:#f92672>=</span> <span style=color:#ae81ff>512</span> bytes
</span></span><span style=display:flex><span>Sector size <span style=color:#f92672>(</span>logical/physical<span style=color:#f92672>)</span>: <span style=color:#ae81ff>512</span> bytes / <span style=color:#ae81ff>512</span> bytes
</span></span><span style=display:flex><span>I/O size <span style=color:#f92672>(</span>minimum/optimal<span style=color:#f92672>)</span>: <span style=color:#ae81ff>512</span> bytes / <span style=color:#ae81ff>512</span> bytes
</span></span><span style=display:flex><span>Disk label type: dos
</span></span><span style=display:flex><span>Disk identifier: 0x000dbca9
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Device Boot      Start         End      Blocks   Id  System
</span></span><span style=display:flex><span>/dev/sda1   *        <span style=color:#ae81ff>2048</span>     <span style=color:#ae81ff>2099199</span>     <span style=color:#ae81ff>1048576</span>   <span style=color:#ae81ff>83</span>  Linux
</span></span><span style=display:flex><span>/dev/sda2         <span style=color:#ae81ff>2099200</span>   <span style=color:#ae81ff>167772159</span>    <span style=color:#ae81ff>82836480</span>   <span style=color:#ae81ff>83</span>  Linux
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Command <span style=color:#f92672>(</span>m <span style=color:#66d9ef>for</span> help<span style=color:#f92672>)</span>: d
</span></span><span style=display:flex><span>Partition number <span style=color:#f92672>(</span>1,2, default 2<span style=color:#f92672>)</span>: <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>Partition <span style=color:#ae81ff>2</span> is deleted
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Command <span style=color:#f92672>(</span>m <span style=color:#66d9ef>for</span> help<span style=color:#f92672>)</span>: n
</span></span><span style=display:flex><span>Partition type:
</span></span><span style=display:flex><span>p   primary <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> primary, <span style=color:#ae81ff>0</span> extended, <span style=color:#ae81ff>3</span> free<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>e   extended
</span></span><span style=display:flex><span>Select <span style=color:#f92672>(</span>default p<span style=color:#f92672>)</span>: p
</span></span><span style=display:flex><span>Partition number <span style=color:#f92672>(</span>2-4, default 2<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>First sector <span style=color:#f92672>(</span>2099200-335544319, default 2099200<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>Using default value <span style=color:#ae81ff>2099200</span>
</span></span><span style=display:flex><span>Last sector, +sectors or +size<span style=color:#f92672>{</span>K,M,G<span style=color:#f92672>}</span> <span style=color:#f92672>(</span>2099200-335544319, default 335544319<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>Using default value <span style=color:#ae81ff>335544319</span>
</span></span><span style=display:flex><span>Partition <span style=color:#ae81ff>2</span> of type Linux and of size <span style=color:#ae81ff>159</span> GiB is set
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Command <span style=color:#f92672>(</span>m <span style=color:#66d9ef>for</span> help<span style=color:#f92672>)</span>: p
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Disk /dev/sda: 171.8 GB, <span style=color:#ae81ff>171798691840</span> bytes, <span style=color:#ae81ff>335544320</span> sectors
</span></span><span style=display:flex><span>Units <span style=color:#f92672>=</span> sectors of <span style=color:#ae81ff>1</span> * 512 <span style=color:#f92672>=</span> <span style=color:#ae81ff>512</span> bytes
</span></span><span style=display:flex><span>Sector size <span style=color:#f92672>(</span>logical/physical<span style=color:#f92672>)</span>: <span style=color:#ae81ff>512</span> bytes / <span style=color:#ae81ff>512</span> bytes
</span></span><span style=display:flex><span>I/O size <span style=color:#f92672>(</span>minimum/optimal<span style=color:#f92672>)</span>: <span style=color:#ae81ff>512</span> bytes / <span style=color:#ae81ff>512</span> bytes
</span></span><span style=display:flex><span>Disk label type: dos
</span></span><span style=display:flex><span>Disk identifier: 0x000dbca9
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Device Boot      Start         End      Blocks   Id  System
</span></span><span style=display:flex><span>/dev/sda1   *        <span style=color:#ae81ff>2048</span>     <span style=color:#ae81ff>2099199</span>     <span style=color:#ae81ff>1048576</span>   <span style=color:#ae81ff>83</span>  Linux
</span></span><span style=display:flex><span>/dev/sda2         <span style=color:#ae81ff>2099200</span>   <span style=color:#ae81ff>335544319</span>   <span style=color:#ae81ff>166722560</span>   <span style=color:#ae81ff>83</span>  Linux
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Command <span style=color:#f92672>(</span>m <span style=color:#66d9ef>for</span> help<span style=color:#f92672>)</span>: w
</span></span><span style=display:flex><span>The partition table has been altered!
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Calling ioctl<span style=color:#f92672>()</span> to re-read partition table.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>WARNING: Re-reading the partition table failed with error 16: Device or   resource busy
</span></span><span style=display:flex><span>The kernel still uses the old table. The new table will be used at
</span></span><span style=display:flex><span>the next reboot or after you run partprobe<span style=color:#f92672>(</span>8<span style=color:#f92672>)</span> or kpartx<span style=color:#f92672>(</span>8<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Syncing disks.
</span></span></code></pre></div><ol start=2><li>使用 fdisk 扩容分区</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>root@server /<span style=color:#f92672>]</span><span style=color:#75715e># pvresize /dev/sda2</span>
</span></span><span style=display:flex><span>Physical volume <span style=color:#e6db74>&#34;/dev/sda2&#34;</span> changed
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span> physical volume<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span> resized or updated / <span style=color:#ae81ff>0</span> physical volume<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span> not resized
</span></span></code></pre></div><ol start=3><li>使用 pvresize</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>root@server /<span style=color:#f92672>]</span><span style=color:#75715e># pvresize /dev/sda2</span>
</span></span><span style=display:flex><span>Physical volume <span style=color:#e6db74>&#34;/dev/sda2&#34;</span> changed
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span> physical volume<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span> resized or updated / <span style=color:#ae81ff>0</span> physical volume<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span> not resized
</span></span></code></pre></div><ol start=4><li>使用 lvextend 扩容扩容 lvm</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>root@server /<span style=color:#f92672>]</span><span style=color:#75715e># lvextend -l +100%FREE /dev/mapper/centos-root</span>
</span></span><span style=display:flex><span>Size of logical volume centos/root changed from 75.12 GiB <span style=color:#f92672>(</span><span style=color:#ae81ff>19231</span> extents<span style=color:#f92672>)</span> to 155.12 GiB <span style=color:#f92672>(</span><span style=color:#ae81ff>39711</span> extents<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Logical volume centos/root successfully resized.
</span></span></code></pre></div><ol start=5><li>使用 xfs_growfs</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>root@server /<span style=color:#f92672>]</span><span style=color:#75715e># xfs_growfs /dev/centos/root</span>
</span></span><span style=display:flex><span>meta-data<span style=color:#f92672>=</span>/dev/mapper/centos-root isize<span style=color:#f92672>=</span><span style=color:#ae81ff>512</span>    agcount<span style=color:#f92672>=</span>9, agsize<span style=color:#f92672>=</span><span style=color:#ae81ff>2301440</span> blks
</span></span><span style=display:flex><span><span style=color:#f92672>=</span>                       sectsz<span style=color:#f92672>=</span><span style=color:#ae81ff>512</span>   attr<span style=color:#f92672>=</span>2, projid32bit<span style=color:#f92672>=</span>1
</span></span><span style=display:flex><span><span style=color:#f92672>=</span>                       crc<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>        finobt<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> spinodes<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>data     <span style=color:#f92672>=</span>                       bsize<span style=color:#f92672>=</span><span style=color:#ae81ff>4096</span>   blocks<span style=color:#f92672>=</span>19692544, imaxpct<span style=color:#f92672>=</span>25
</span></span><span style=display:flex><span><span style=color:#f92672>=</span>                       sunit<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>      swidth<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> blks
</span></span><span style=display:flex><span>naming   <span style=color:#f92672>=</span>version <span style=color:#ae81ff>2</span>              bsize<span style=color:#f92672>=</span><span style=color:#ae81ff>4096</span>   ascii-ci<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> ftype<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>log      <span style=color:#f92672>=</span>internal               bsize<span style=color:#f92672>=</span><span style=color:#ae81ff>4096</span>   blocks<span style=color:#f92672>=</span>4495, version<span style=color:#f92672>=</span>2
</span></span><span style=display:flex><span><span style=color:#f92672>=</span>                       sectsz<span style=color:#f92672>=</span><span style=color:#ae81ff>512</span>   sunit<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> blks, lazy-count<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>realtime <span style=color:#f92672>=</span>none                   extsz<span style=color:#f92672>=</span><span style=color:#ae81ff>4096</span>   blocks<span style=color:#f92672>=</span>0, rtextents<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>data blocks changed from <span style=color:#ae81ff>19692544</span> to <span style=color:#ae81ff>40664064</span>
</span></span></code></pre></div><ul class=pa0></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"></aside></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=http://example.org/>&copy; 月心月士的博客 2022</a><div><div class=ananke-socials></div></div></div></footer></body></html>